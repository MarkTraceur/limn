vows = require 'vows'
assert = require 'assert'

ko = require 'knockout'
ko.mapping = require '../static/vendor/knockout.mapping.js' unless ko.mapping

{ Model,
} = require '../src/model'

bareModel = new Model()
bareJSON = '{"name":"math class","room":"1A","teacher":"Jones","students":[{"name":"Alex"},{"name":"Maria"}]}'
bareObject = JSON.parse bareJSON

vows
    .describe('Model Serialization')
    .addBatch do
        'when serializing an empty model':
            topic: ->
                JSON.stringify bareModel
            'we get JSON representing an empty object': (topic) ->
                assert.equal topic, "{}"
        
        'when serializing a model with JSON':
            topic: ->
                modelFromObject = new Model(bareObject)
                JSON.stringify modelFromObject
            'we get the same JSON we constructed it with': (topic) ->
                assert.equal topic, bareJSON
        
        'when serializing a model with JSON after it was modified':
            topic: ->
                modelFromObject = new Model(bareObject)
                modelFromObject.set 'name', 'mathematics class'
                modelFromObject.unset 'students'
                JSON.stringify modelFromObject
            'we get the expected JSON': (topic) ->
                assert.equal topic, '{"name":"math class","room":"1A","teacher":"Jones"}'
    .export(module)

