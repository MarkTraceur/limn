vows = require 'vows'
assert = require 'assert'

{ Model,
} = require '../src/model'

bareModel = new Model()
bareJSON = '{"name":"math class","room":"1A","teacher":"Jones","students":[{"name":"Alex"},{"name":"Maria"}]}'
bareObject = JSON.parse bareJSON

vows
    .describe('Model Serialization')
    .addBatch(
        'when serializing an empty model':
            topic: ->
                bareModel.toJSON()
            'we get JSON representing an empty object': (topic) ->
                assert.equal topic, "{}"
        
        ,'when serializing a model with JSON':
            topic: ->
                modelFromObject = new Model(bareObject)
                modelFromObject.toJSON()
            'we get the same JSON we constructed it with': (topic) ->
                assert.equal topic, bareJSON
        
        ,'when serializing a model with JSON after it was modified':
            topic: ->
                modelFromObject = new Model(bareObject)
                modelFromObject.set 'name', 'mathematics class'
                modelFromObject.unset 'students'
                modelFromObject.toJSON()
            'we get the expected JSON'
                assert.equal topic, '{"name":"mathematics class","room":"1A","teacher":"Jones"}'
    )
    .export(module)

